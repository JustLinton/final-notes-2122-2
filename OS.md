 

### 导言

#### 操作系统的四个特征

- 并发
  - 两个或多个事件`同时发生`，确切的说是同`一段时间`内,而非一个时刻。如果真的同一时刻同时发生，那叫`并行`。
- 共享
  - 共享即资源在进程间的共享，分为互斥共享和同时访问共享。前者用于临界资源。
  - 共享为并发提供了条件。如果资源不能被两个进程共同访问，那么他们也就不可能互斥执行。
- 虚拟
  - 把物理的实体变成逻辑上的实体，并能赋予其新的特征。例如虚存、Spooling等。
- 异步
  - 因为对进城来说，资源并不总是充足的，所以进程是走走停停的，也就是他推进的速度是无法预知的。这种无法预知的推进速度即异步。
  - OS需要保证就算这些进程是异步推进的，其执行结果也应当符合预期。（即多次执行，结果一致）

#### 操作系统的作用

- 操作系统是工人，它操作计算机这个机器。用户是雇主。
- 操作系统操作机器，即对**处理器，存储器、设备、文件**四大部分进行**管理**；
- 雇主要给工人传递命令，工人要反馈，即操作系统要对用户预留**接口**。
  - 这种接口分为程序接口和命令接口。前者是例如系统调用API；后者是用户界面。
  - 命令接口分为联机接口和脱机接口。前者是交互式的，例如shell；后者是批处理的，例如slurm。
- 有了工人，机器才能发挥出更大作用，所以操作系统可以**扩充计算机系统**。
  - 扩充计算机系统，是相对于计算机裸机（没有软件覆盖的计算机系统）而言的。
  - 有了OS，裸机才能发挥**应有的功能**。

#### 批处理系统

- 为了解决IO速度和CPU之间的**速度差异**。
- 批处理分为单道批处理和多道批处理。后者是在宏观上并行，在微观上串行。

#### 分时系统

- 为了解决用户不能**交互**的问题。
- 把CPU时间划分成时间片，每个时间片给一个用户，这样轮流使用。如果某作业不能在这个时间片内完成，就进入等待，等待下一次其得到时间片。因为时间片较短，所以用户感觉好像自己独占了计算机。
- 分时系统是交互式系统，通过多个终端连接到中心计算机上实现。其交互性是和批处理系统的最大区别。
- **现在的OS例如Windows可以理解为分时系统，而分时的对象不再是用户，而是一个个进程。**

#### 实时系统

- 分时系统虽然在宏观上是交互的，但是在微观上其还是会有一定的延迟。这对于诸如导弹发射这样的精确任务不能胜任。
- 实时系统的特点是：必须在完全正确的时间点给出响应（如导弹制导），或必须在一定时间限制内给出响应（如订票系统）。前者称为**硬实时**，后者称为**软实时**。
- 常使用**抢占式的优先级高者优先**调度算法。
- 实时系统的目标是响应速度。为此它**可以放弃**一定的资源利用率。**因此实时系统资源利用率一般比较低。**

#### 网络操作系统、分布式操作系统

- 网络操作系统
  - 计算机之间可以通信和资源共享。但是**不能协作**完成工作。
- 分布式操作系统具有分布性、并行性。
  - 计算机之间没有主从关系。计算机之间可以通信和资源共享。
  - 分布性：任何工作可以分布在若干计算机上，协同完成任务。

#### 核心态、用户态

- 可以执行特权指令的状态是核心态。可以理解为CPU有一小开关，控制着当前是否处于核心态。
  - 常见特权指令：IO指令
- **内核运行在核心态，用户程序运行在用户态。**
- 从用户态转为核心态的过程称为“陷入”。“陷入”是硬件过程，即**只要**发生了中断，**硬件**就会把核心态标志位置1.

#### 内核

- 内核是操作系统最底层的软件，是计算机功能的延伸。
- 内核包括以下四部分内容：
  - 时钟管理
    - 系统维护一个时钟
    - 时钟可以为用户提供标准时间
    - 时钟是分时系统的关键。当进程的时间片用完，它就从执行态转为就绪态。
  - 中断机制
    - 中断发明的初衷是提升CPU的利用率（例如进行IO时，你数据传完了再提出中断去高速CPU，则实现了IO设备与CPU的并行。）
    - **在中断中，内核负责保护现场（仅保存程序状态字，因为PC是隐指令负责的）和恢复现场、转到中断处理程序。**
  - 原语
    - 是操作系统最**接近硬件**的“小程序”，他们具有**原子性**，并且常常会被**频繁调用**。
    - **原子性通过进入程序时关中断，离开程序时开中断实现。**（只要关闭了中断，就不会被抢占。因为所谓时间片用尽、抢占，这些都是基于中断实现的。）
  - 系统控制的数据结构及处理
    - 数据结构就是用于OS正常运行的状态信息，包括PCB、FCB、Page Table等。

#### 外中断和内中断

- 外中断又称中断，是和当前CPU执行的程序**没有关系**的中断，例如键盘中断、打印机、时钟中断。它的中断处理程序往往**不**需要上下文信息。
- 内中断又称异常、陷阱。内中断不能被屏蔽，一旦出现必须处理；它的中断处理程序**需要上下文信息**。
  - 例：软件出错、硬件出错、访管中断（调用访管指令（访管指令只能由用户态下执行，用于主动切换核心态））、用户程序错误地**尝试使用特权指令**等。
- **无论是内中断还是外中断，只要发生中断，CPU就从用户态陷入核心态。**从用户态转为核心态的过程称为“陷入”。“陷入”是硬件过程，即只要发生了中断，**硬件**就会把核心态标志位置1.

#### 系统调用

- 在用户态下执行陷阱指令，就陷入核心态，此时CPU由内核接管，在核心态执行，提供相应功能。执行完毕后，再返回用户态，从而返回用户程序。
- **在编写C程序时，通过API调用系统调用函数，这些函数会被编译成陷阱指令和若干相关参数。**

